<link rel="import" href="../bower_components/polymer/polymer.html">
<script type="text/javascript" src="../bower_components/leaflet/dist/leaflet.js"></script>

<polymer-element name="remix-map" attributes="latitude longitude zoom">
  <template>
    <link rel="stylesheet" href="../bower_components/leaflet/dist/leaflet.css" />
	<style>
		:host { display: block; } 
		:host #map {height:100%; width:100%}
	</style>
	<div id="map"></div>
	<content id="markers" select="*"></content>
  </template>
  <script>
    function loadJSON(path, success, error)
    {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function()
        {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                    if (success)
                        success(JSON.parse(xhr.responseText));
                } else {
                    if (error)
                        error(xhr);
                }
            }
        };
        xhr.open("GET", path, true);
        xhr.send();
    };
    
  	Polymer('remix-map', {
      domReady: function() {
        var map = L.map(this.$.map, {
            center: [this.latitude, this.longitude],
            zoom  : this.zoom
          });
        this.map = map;
        // add a default layer if there are no layers defined
		var defaultLayerRequired = true;
		for (var i = 0; i < this.children.length; i++) {
			var e = this.children[i];
			if (e.isLayer && e.isLayer()) {
				defaultLayerRequired = false;
			}
		}
		if (defaultLayerRequired) {
			L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery &copy; <a href="http://mapbox.com">Mapbox</a>',
				maxZoom: 18
			}).addTo(this.map);
		};
		loadJSON("data/projects.json", function(elements) {
            for (var i=0; i < elements.length; i++) {
    		     var e = elements[i];
    		     var marker = L.marker([e.lat, e.lon], {
    					clickable: true,
    					title: e.title,
    					alt: e.title
    				});
    		     marker.bindPopup(e.description);
    		     marker.addTo(map);
    		   }
          }, function(xhr) { console.error(xhr); });
      }
    });
  </script>
</polymer-element>
